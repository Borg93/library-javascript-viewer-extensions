(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{1203:function(e,n,o){"use strict";o.r(n);o(1204);n.default="Viewing.Extension.MarqueeSelect"},1204:function(e,n,o){"use strict";(function(e){var n=o(30),t=o.n(n),i=o(42),d=o.n(i),a=o(2),s=o.n(a),r=o(3),u=o.n(r),c=o(5),l=o.n(c),h=o(4),f=o.n(h),v=o(50),w=o.n(v),p=o(6),x=o.n(p),y=o(17),m=o.n(y),E=o(1205),g=o(21),M=o.n(g),_=o(443),k=o(451),b=window,L=b.Autodesk,A=b.THREE,T=function(n){function o(n,t){var i;return s()(this,o),i=l()(this,f()(o).call(this,n,t)),m()(w()(i),"lockViewport",function(){i.viewer.setNavigationLock(!0)}),m()(w()(i),"unlockViewport",function(){i.viewer.setNavigationLock(!1)}),m()(w()(i),"getExternalIdMapping",function(){var n=w()(i).viewer;return new e(function(e){n.model.getExternalIdMapping(function(n){e(n)})})}),m()(w()(i),"enumNodeFragments",function(n){var o=w()(i).viewer,t=o.model.getData().instanceTree,d=o.model.getFragmentList(),a=new A.Box3,s=new A.Box3;return new e(function(e){t.enumNodeFragments(n,function(n){d.getWorldBounds(n,s),a.union(s),e(a)},!0)})}),m()(w()(i),"onMouseMove",function(e){var n={};n.x=e.clientX-i.mousedowncoords.x,n.y=e.clientY-i.mousedowncoords.y,!i._control.isActivated||!i.mousedown||Math.abs(n.y)<50||Math.abs(n.x)<50||(n.x<0&&n.y<0?i.marquee.css({left:"".concat(e.clientX-i.offset.x,"px"),width:"".concat(-n.x,"px"),top:"".concat(e.clientY-i.offset.y,"px"),height:"".concat(-n.y)}):n.x>=0&&n.y<=0?i.marquee.css({left:"".concat(i.mousedowncoords.x-i.offset.x,"px"),width:"".concat(n.x,"px"),top:"".concat(e.clientY-i.offset.y,"px"),height:"".concat(-n.y,"px")}):n.x>=0&&n.y>=0?i.marquee.css({left:"".concat(i.mousedowncoords.x-i.offset.x,"px"),width:"".concat(n.x,"px"),height:"".concat(n.y,"px"),top:"".concat(i.mousedowncoords.y-i.offset.y,"px")}):n.x<0&&n.y>=0&&i.marquee.css({left:"".concat(e.clientX-i.offset.x,"px"),width:"".concat(-n.x,"px"),height:"".concat(n.y,"px"),top:"".concat(i.mousedowncoords.y-i.offset.y,"px")}),i.findCubesByVertices({x:e.clientX,y:e.clientY}))}),m()(w()(i),"findCubesByVertices",function(e){i.findBounds(e,i.mousedowncoords)}),m()(w()(i),"findBounds",function(e,n){var o={},t={};e.y<n.y?(o.y=e.y,t.y=n.y-e.y):(o.y=n.y,t.y=e.y-n.y),e.x<n.x?(o.x=e.x,t.x=n.x-e.x):(o.x=n.x,t.x=e.x-n.x);var d={origin:o,delta:t};return i.bounds=d,d}),m()(w()(i),"withinBounds",function(e,n){var o=n.origin.x,t=n.origin.x+n.delta.x,i=n.origin.y,d=n.origin.y+n.delta.y;return e.x>=o&&e.x<=t&&e.y>=i&&e.y<=d}),i.viewer=n,i.options=t||{},i.onMouseUp=i.onMouseUp.bind(w()(i)),i.onMouseDown=i.onMouseDown.bind(w()(i)),i.init(),i}var i,a,r,c;return x()(o,n),u()(o,[{key:"init",value:function(){var e=this;this.mousedown=!1,this.mousedowncoords={},this.dbIdPP={},this.offset={x:0,y:0},this.bounds={origin:{x:0,y:0},delta:{x:0,y:0}},document.getElementById("select-marquee")||M()(".canvas-wrap").append('<div id="select-marquee"></div>'),this.marquee=M()("#select-marquee").css({width:0,height:0,display:"none","background-color":"rgba(208, 255, 242, 0.5)",border:"dotted 1px #9a9a9a","z-index":100,position:"absolute"}),this._control=k.a.createButton("marquee-select-icon","glyphicon glyphicon-unchecked","Marquee Select",function(){e.toggleActiveButton()}),this.buzzParentControl=new L.Viewing.UI.ControlGroup("marquee-select"),this.buzzParentControl.addControl(this._control),this.viewer.getToolbar(!0).addControl(this.buzzParentControl)}},{key:"toggleActiveButton",value:function(){this._control.isActivated?(this._control.isActivated=!1,this._control.container.classList.remove("active")):(this._control.isActivated=!0,this._control.container.classList.add("active"))}},{key:"getShowIds",value:(c=d()(t.a.mark(function e(){var n;return t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getExternalIdMapping();case 2:return n=e.sent,e.abrupt("return",Object.values(n));case 4:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"getIdsByExternalId",value:function(e,n,o){var t=[],i=this.viewer.model.getRootId();if(!n.length)return t;if(n[0]===i&&!1===o)return t;if(n[0]===i&&o)return Object.values(e);var d=Object(E.clone)(e);return n.forEach(function(e){var n=Object(E.findKey)(d,function(n){return e===n});Object(E.forOwn)(d,function(e,i){i.startsWith(n)===o&&(d=Object(E.omit)(d,n),t.push(e))})}),t}},{key:"onMouseDown",value:(r=d()(t.a.mark(function e(n){var o,i,d;return t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._control.isActivated){e.next=2;break}return e.abrupt("return");case 2:this.lockViewport(),this.marquee.show(),this.mousedown=!0,this.mousedowncoords.x=n.clientX,this.mousedowncoords.y=n.clientY,o=this.viewer,i=o.canvas,d=i.getBoundingClientRect(),this.offset={x:d.left,y:d.top};case 11:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"calcDbidPP",value:(a=d()(t.a.mark(function e(n){var o,i,a=this;return t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o={},i=this.viewer,n.forEach(function(){var e=d()(t.a.mark(function e(n){var d,s,r,u,c,l;return t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.enumNodeFragments(n);case 2:d=e.sent,s=d.max,r=d.min,u={x:(s.x+r.x)/2,y:(s.y+r.y)/2,z:(s.z+r.z)/2},c={x:r.x,y:r.y,z:r.z},l={x:s.x,y:s.y,z:s.z},o[n]={},o[n].max=i.impl.worldToClient(l),o[n].min=i.impl.worldToClient(c),o[n].pivot=i.impl.worldToClient(u);case 11:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()),this.dbIdPP=o;case 4:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"onMouseUp",value:(i=d()(t.a.mark(function e(n){var o,i,d,a,s,r,u=this;return t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.marquee.fadeOut(),setTimeout(function(){u.unlockViewport(),u.marquee.css({width:0,height:0})},100),this.mousedown){e.next=4;break}return e.abrupt("return");case 4:return this.viewer,o=this.viewer.getHiddenNodes(),e.next=8,this.getShowIds();case 8:return i=e.sent,e.next=11,this.calcDbidPP(i);case 11:d=Object(E.keys)(this.dbIdPP),a=[],s=this.viewer.model.getRootId(),d.forEach(function(e){if(+e!==s){var n=u.dbIdPP[e],o=n.min,t=n.max,i=u.withinBounds({x:t.x+u.offset.x,y:t.y+u.offset.y},u.bounds),d=u.withinBounds({x:o.x+u.offset.x,y:o.y+u.offset.y},u.bounds);i&&d&&a.push(+e)}}),r=Object(E.difference)(a,o),this.viewer.select(r),this.mousedown=!1,window.ttt=this;case 19:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"load",value:function(){return M()(".canvas-wrap").on("mousedown",this.onMouseDown),M()(".canvas-wrap").on("mouseup",this.onMouseUp),M()(".canvas-wrap").on("mousemove",this.onMouseMove),console.log("Viewing.Extension.MarqueeSelect loaded"),!0}},{key:"unload",value:function(){return M()(".canvas-wrap").off("mousedown",this.onMouseDown),M()(".canvas-wrap").off("mouseup",this.onMouseUp),M()(".canvas-wrap").off("mousemove",this.onMouseMove),this.init(),!0}}],[{key:"ExtensionId",get:function(){return"Viewing.Extension.MarqueeSelect"}}]),o}(_.a);L.Viewing.theExtensionManager.registerExtension(T.ExtensionId,T)}).call(this,o(31))},443:function(e,n,o){"use strict";var t=o(444);n.a=t.a},444:function(e,n,o){"use strict";(function(e){o.d(n,"a",function(){return x});var t=o(116),i=o.n(t),d=o(2),a=o.n(d),s=o(3),r=o.n(s),u=o(5),c=o.n(u),l=o(4),h=o.n(l),f=o(50),v=o.n(f),w=o(6),p=o.n(w),x=function(n){function o(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a()(this,o),n=c()(this,h()(o).call(this,e)),Object.assign(v()(n),t.serviceContext),n.onModelCompletedLoad=n.onModelCompletedLoad.bind(v()(n)),n.onObjectTreeCreated=n.onObjectTreeCreated.bind(v()(n)),n.onModelRootLoaded=n.onModelRootLoaded.bind(v()(n)),n.onExtensionLoaded=n.onExtensionLoaded.bind(v()(n)),n.onModelActivated=n.onModelActivated.bind(v()(n)),n.onGeometryLoaded=n.onGeometryLoaded.bind(v()(n)),n.onToolbarCreated=n.onToolbarCreated.bind(v()(n)),n.onModelBeginLoad=n.onModelBeginLoad.bind(v()(n)),n.onModelUnloaded=n.onModelUnloaded.bind(v()(n)),n.onSelection=n.onSelection.bind(v()(n)),n.__onModelRootLoaded=n.__onModelRootLoaded.bind(v()(n)),n.__onModelActivated=n.__onModelActivated.bind(v()(n)),n.__onModelUnloaded=n.__onModelUnloaded.bind(v()(n)),n.__onModelLoaded=n.__onModelLoaded.bind(v()(n)),n.defaultOptions=i,n.options=Object.assign({},i,t),n.viewer=e;var d=e.impl.modelQueue().getModels();return n.models=d.map(function(e){return e.guid=e.guid||n.guid(),e}),n.initializeEvents(),n}return p()(o,n),r()(o,[{key:"load",value:function(){return!0}},{key:"unload",value:function(){var e=this;return this.viewerEvents.forEach(function(n){e.viewer.removeEventListener(n.id,e[n.handler])}),this.eventSink&&(this.eventSink.off("model.activated",this.__onModelActivated),this.eventSink.off("model.unloaded",this.__onModelUnloaded),this.eventSink.off("model.loaded",this.__onModelLoaded)),this.off(),!0}},{key:"reload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=Object.assign({},this.defaultOptions,this.options,e),!0}},{key:"onExtensionLoaded",value:function(e){}},{key:"onModelBeginLoad",value:function(e){}},{key:"onModelActivated",value:function(e){}},{key:"__onModelRootLoaded",value:function(e){var n=this;this.viewerEvent([Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,Autodesk.Viewing.GEOMETRY_LOADED_EVENT]).then(function(e){n.onModelCompletedLoad(e[0])})}},{key:"onModelRootLoaded",value:function(e){}},{key:"onObjectTreeCreated",value:function(e){}},{key:"onGeometryLoaded",value:function(e){}},{key:"onModelCompletedLoad",value:function(e){}},{key:"onToolbarCreated",value:function(e){}},{key:"onModelUnloaded",value:function(e){}},{key:"onSelection",value:function(e){}},{key:"__onModelLoaded",value:function(e){this.models=[].concat(i()(this.models),[e.model]),this.onModelBeginLoad(e)}},{key:"__onModelActivated",value:function(e){this.onModelActivated(e)}},{key:"__onModelUnloaded",value:function(e){this.models=this.models.filter(function(n){return n.guid!==e.model.guid}),this.onModelUnloaded(e)}},{key:"initializeEvents",value:function(){var e=this;this.options.eventSink&&(this.eventSink=this.options.eventSink,this.eventSink.on("model.loaded",this.__onModelLoaded),this.eventSink.on("model.activated",this.__onModelActivated),this.eventSink.on("model.unloaded",this.__onModelUnloaded)),this.viewerEvents=[{id:Autodesk.Viewing.EXTENSION_LOADED_EVENT,handler:"onExtensionLoaded"},{id:Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,handler:"onObjectTreeCreated"},{id:Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,handler:"__onModelRootLoaded"},{id:Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,handler:"onModelRootLoaded"},{id:Autodesk.Viewing.GEOMETRY_LOADED_EVENT,handler:"onGeometryLoaded"},{id:Autodesk.Viewing.TOOLBAR_CREATED_EVENT,handler:"onToolbarCreated"},{id:Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,handler:"onSelection"}],this.viewerEvents.forEach(function(n){e.viewerEvent(n.id,e[n.handler])})}},{key:"viewerEvent",value:function(n,o){var t=this;if(!o){var i=(Array.isArray(n)?n:[n]).map(function(n){return new e(function(e){t.viewer.addEventListener(n,function o(i){t.viewer.removeEventListener(n,o),e(i)})})});return e.all(i)}this.viewer.addEventListener(n,o)}}],[{key:"ExtensionId",get:function(){return"Viewing.Extension.MultiModelExtensionBase"}}]),o}(o(117).a.Composer(Autodesk.Viewing.Extension))}).call(this,o(31))}}]);
//# sourceMappingURL=99.js.map