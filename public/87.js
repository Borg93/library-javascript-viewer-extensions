(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{1352:function(e,t,i){"use strict";i.r(t);i(1353);t.default="Viewing.Extension.Transform"},1353:function(e,t,i){"use strict";(function(e){var t=i(30),n=i.n(t),o=i(42),a=i.n(o),r=i(116),s=i.n(r),l=i(2),c=i.n(l),h=i(3),E=i.n(h),u=i(5),p=i.n(u),m=i(4),d=i.n(m),v=i(6),y=i.n(v),T=i(1354),f=i(491),w=i(1356),R=i(451),g=i(513),x=i(624),M=i.n(x),H=function(t){function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c()(this,i),(t=p()(this,d()(i).call(this,e,n))).translateTool=new T.a(e),t.rotateTool=new w.a(e),t.transformedFragIdMap={},t.translateTool.on("selection",function(e){var i=e?Object.assign({},e,{type:"translate"}):null;t.emit("selection",i)}),t.translateTool.on("translate",function(e){e.fragIds.forEach(function(e){t.transformedFragIdMap[e]=!0}),t.emit("transform",{transform:{translation:e.translation},fragIds:e.fragIds,model:e.model,dbIds:e.dbIds})}),t.translateTool.on("deactivate",function(){t._txControl.container.classList.remove("active"),t._comboCtrl.container.classList.remove("active"),t.emit("deactivate")}),t.rotateTool.on("selection",function(e){var i=e?Object.assign({},e,{type:"rotate"}):null;t.emit("selection",i)}),t.rotateTool.on("rotate",function(e){e.fragIds.forEach(function(e){t.transformedFragIdMap[e]=!0}),t.emit("transform",{transform:{rotation:e.rotation},fragIds:e.fragIds,model:e.model,dbIds:e.dbIds})}),t.rotateTool.on("deactivate",function(){t._rxControl.container.classList.remove("active"),t._comboCtrl.container.classList.remove("active"),t.emit("deactivate")}),t}return y()(i,t),E()(i,[{key:"load",value:function(){return console.log("Viewing.Extension.Transform loaded"),!0}},{key:"onToolbarCreated",value:function(){var e=this;if(this._txControl=R.a.createButton("toolbar-translate","fa fa-arrows-alt","Translate Tool",function(){e.translateTool.active?(e.translateTool.deactivate(),e._txControl.container.classList.remove("active"),e._comboCtrl.container.classList.remove("active")):e.translate()}),this._rxControl=R.a.createButton("toolbar-rotate","fa fa-refresh","Rotate Tool",function(){e.rotateTool.active?(e.rotateTool.deactivate(),e._rxControl.container.classList.remove("active"),e._comboCtrl.container.classList.remove("active")):e.rotate()}),this.parentControl=this._options.parentControl,"string"==typeof this.parentControl){var t=this._viewer.getToolbar(!0);this.parentControl=t.getControl(this.parentControl)}if(!this.parentControl&&!this._options.hideControls){t=this._viewer.getToolbar(!0);this.parentControl=new Autodesk.Viewing.UI.ControlGroup("transform"),t.addControl(this.parentControl)}this._comboCtrl=new Autodesk.Viewing.UI.ComboButton("toolbar-transform"),this._comboCtrl.setToolTip("Transform Tools"),this._comboCtrl.icon.style.fontSize="24px",this._comboCtrl.icon.style.transform="rotateY(180Deg)",this._comboCtrl.icon.className="glyphicon glyphicon-wrench",this._comboCtrl.addControl(this._txControl),this._comboCtrl.addControl(this._rxControl);var i=this._comboCtrl.onClick;this._comboCtrl.onClick=function(t){e._comboCtrl.container.classList.contains("active")?e.deactivate():i()},this._options.hideControls||this.parentControl.addControl(this._comboCtrl)}},{key:"unload",value:function(){this.parentControl.removeControl(this._comboCtrl),this.translateTool.deactivate(),this.rotateTool.deactivate(),console.log("Viewing.Extension.Transform unloaded")}},{key:"translate",value:function(){this.translateTool.activate(),this._txControl.container.classList.add("active"),this.rotateTool.deactivate(),this._rxControl.container.classList.remove("active"),this._comboCtrl.container.classList.add("active")}},{key:"rotate",value:function(){this.rotateTool.activate(),this._rxControl.container.classList.add("active"),this.translateTool.deactivate(),this._txControl.container.classList.remove("active"),this._comboCtrl.container.classList.add("active")}},{key:"deactivate",value:function(){this._txControl.container.classList.remove("active"),this._rxControl.container.classList.remove("active"),this._comboCtrl.container.classList.remove("active"),this.translateTool.deactivate(),this.rotateTool.deactivate()}},{key:"setFullTransform",value:function(e){this.translateTool.setFullTransform(e),this.rotateTool.setFullTransform(e)}},{key:"pickPosition",value:function(){this.translateTool.onPick()}},{key:"clearSelection",value:function(){this.translateTool.clearSelection(),this.rotateTool.clearSelection()}},{key:"getState",value:function(e){for(var t in this.currentExplodeScale=this.currentExplodeScale||this._viewer.getExplodeScale(),e.explodeScale=this.currentExplodeScale,e.transforms={},this.transformedFragIdMap){var i=this._viewer.impl.getFragmentProxy(this._viewer.model,t);i.getAnimTransform(),e.transforms[t]={quaternion:i.quaternion,position:i.position}}}},{key:"restoreState",value:function(e,t){var i=this;if(this.translateTool.clearSelection(),this.rotateTool.clearSelection(),e.transforms){this.animateTransform(e,function(e){return M.a.easeInOutExpo(e,0,1,1.26)},1.8).then(function(){i.currentExplodeScale=e.explodeScale}),this.transformedFragIdMap=Object.assign({},e.transforms),this.viewer.impl.sceneUpdated(!0)}}},{key:"restoreTransform",value:function(e){var t=this,i=Object.keys(this.transformedFragIdMap),n=Object.keys(e.transforms);[].concat(s()(i),s()(n)).forEach(function(i){var n=e.transforms[i]||{quaternion:{_x:0,_y:0,_z:0,_w:1},position:{x:0,y:0,z:0}},o=viewer.impl.getFragmentProxy(t._viewer.model,i);o.getAnimTransform(),o.position.x=n.position.x,o.position.y=n.position.y,o.position.z=n.position.z,o.quaternion._x=n.quaternion._x,o.quaternion._y=n.quaternion._y,o.quaternion._z=n.quaternion._z,o.quaternion._w=n.quaternion._w,o.updateAnimTransform()})}},{key:"animateTransform",value:function(t,i){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return new e(function(){var l=a()(n.a.mark(function a(l,c){var h,E,u,p,m,d,v,y,T,f,w,x,M,H;return n.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return h=o._viewer,E=Object.keys(o.transformedFragIdMap),u=Object.keys(t.transforms),p=[].concat(s()(E),s()(u)),m=p.map(function(e){var i=h.impl.getFragmentProxy(h.model,e);i.getAnimTransform();var n=t.transforms[e]||{quaternion:{_x:0,_y:0,_z:0,_w:1},position:{x:0,y:0,z:0}};return i.step={dx:(n.position.x-i.position.x)/r,dy:(n.position.y-i.position.y)/r,dz:(n.position.z-i.position.z)/r,dQx:(n.quaternion._x-i.quaternion._x)/r,dQy:(n.quaternion._y-i.quaternion._y)/r,dQz:(n.quaternion._z-i.quaternion._z)/r,dQw:(n.quaternion._w-i.quaternion._w)/r},i.initialTransform={quaternion:{_x:i.quaternion._x,_y:i.quaternion._y,_z:i.quaternion._z,_w:i.quaternion._w},position:{x:i.position.x,y:i.position.y,z:i.position.z}},i.targetTransform=n,i}),n.next=7,e.all(m);case 7:d=n.sent,v=d.map(function(e){return{step:function(t){e.quaternion._x+=e.step.dQx*t,e.quaternion._y+=e.step.dQy*t,e.quaternion._z+=e.step.dQz*t,e.quaternion._w+=e.step.dQw*t,e.position.x+=e.step.dx*t,e.position.y+=e.step.dy*t,e.position.z+=e.step.dz*t,e.updateAnimTransform()},ease:function(t){var n=i(t/r),o=e.targetTransform.quaternion,a=e.initialTransform.quaternion,s=new THREE.Quaternion(a._x,a._y,a._z,a._w),l=new THREE.Quaternion(o._x,o._y,o._z,o._w);s.slerp(l,n),e.quaternion._x=s.x,e.quaternion._y=s.y,e.quaternion._z=s.z,e.quaternion._w=s.w;var c=e.targetTransform.position,h=e.initialTransform.position;e.position.x=n*c.x+(1-n)*h.x,e.position.y=n*c.y+(1-n)*h.y,e.position.z=n*c.z+(1-n)*h.z,e.updateAnimTransform()},finalStep:function(){e.quaternion._x=e.targetTransform.quaternion._x,e.quaternion._y=e.targetTransform.quaternion._y,e.quaternion._z=e.targetTransform.quaternion._z,e.quaternion._w=e.targetTransform.quaternion._w,e.position.copy(e.targetTransform.position),e.updateAnimTransform()}}}),y=parseFloat(o.currentExplodeScale),(T=parseFloat(t.explodeScale))!=y&&(f=(T-y)/r,v.push({step:function(e){y+=f*e,R.a.selectiveExplode(h,y,p)},ease:function(e){var t=i(e/r),n=y+t*(T-y);R.a.selectiveExplode(h,n,p)},finalStep:function(){R.a.selectiveExplode(h,T,p),h.explodeSlider.value=T}})),w=0,x=0,M=new g.a,H=function e(){var t=.001*M.getElapsedMs();(x+=t)<r?(v.forEach(function(e){e.ease(x)}),w=requestAnimationFrame(e)):(v.forEach(function(e){e.finalStep()}),cancelAnimationFrame(w),h.autocam.shotParams.duration=1),h.impl.sceneUpdated(!0),l()},h.autocam.shotParams.duration=r,w=requestAnimationFrame(H);case 18:case"end":return n.stop()}},a)}));return function(e,t){return l.apply(this,arguments)}}())}}],[{key:"ExtensionId",get:function(){return"Viewing.Extension.Transform"}}]),i}(f.a);Autodesk.Viewing.theExtensionManager.registerExtension(H.ExtensionId,H)}).call(this,i(31))},1354:function(e,t,i){"use strict";i.d(t,"a",function(){return R});var n=i(30),o=i.n(n),a=i(42),r=i.n(a),s=i(2),l=i.n(s),c=i(3),h=i.n(c),E=i(5),u=i.n(E),p=i(4),m=i.n(p),d=i(50),v=i.n(d),y=i(6),T=i.n(y),f=i(117),w=i(451),R=(i(1355),function(e){function t(e){var i;return l()(this,t),(i=u()(this,m()(t).call(this)))._dbIds=[],i.active=!1,i._viewer=e,i._isDragging=!1,i.fullTransform=!1,i._transformMesh=null,i._selectedFragProxyMap={},i._transformControlTx=null,i._hitPoint=new THREE.Vector3,i.onTxChange=i.onTxChange.bind(v()(i)),i.onAggregateSelectionChanged=i.onAggregateSelectionChanged.bind(v()(i)),i.onCameraChanged=i.onCameraChanged.bind(v()(i)),i._selectionMode="SELECTION_MODE_TRANSFORM",e.toolController.registerTool(v()(i)),i}var i;return T()(t,e),h()(t,[{key:"getNames",value:function(){return["Viewing.Tool.Translate"]}},{key:"getName",value:function(){return"Viewing.Tool.Translate"}},{key:"setFullTransform",value:function(e){this.fullTransform=e,this.clearSelection()}},{key:"createTransformMesh",value:function(){var e=new THREE.MeshPhongMaterial({color:16711680});this._viewer.impl.matman().addMaterial("transform-tool-material",e,!0);var t=new THREE.Mesh(new THREE.SphereGeometry(1e-4,5),e);return t.position.set(0,0,0),t}},{key:"onTxChange",value:function(){if(this._isDragging&&this._transformControlTx.visible){var e=new THREE.Vector3(this._transformMesh.position.x-this._selection.model.offset.x,this._transformMesh.position.y-this._selection.model.offset.y,this._transformMesh.position.z-this._selection.model.offset.z);for(var t in this._selectedFragProxyMap){var i=this._selectedFragProxyMap[t],n=new THREE.Vector3(this._transformMesh.position.x-i.offset.x,this._transformMesh.position.y-i.offset.y,this._transformMesh.position.z-i.offset.z);i.position=n,i.updateAnimTransform()}this.emit("translate",{fragIds:Object.keys(this._selectedFragProxyMap),model:this._selection.model,translation:e})}this._viewer.impl.sceneUpdated(!0)}},{key:"onCameraChanged",value:function(){this._transformControlTx&&this._transformControlTx.update()}},{key:"onAggregateSelectionChanged",value:function(e){var t=this;switch(this._selectionMode){case"SELECTION_MODE_TRANSFORM":if(this._selection&&this.pointerDown)return this._selectionMode="SELECTION_MODE_RESUME_TRANSFORM",this._viewer.clearSelection(),void(this._selection.model.selector&&this._selection.model.selector.setSelection(this._dbIds));if(e.selections.length){var i=e.selections[0];this.setSelection(i)}else this.clearSelection();break;case"SELECTION_MODE_PICK":e.selections&&e.selections.length&&(this._selectionMode="SELECTION_MODE_RESUME_TRANSFORM",this._viewer.clearSelection(),this._selection.model.selector&&this._selection.model.selector.setSelection(this._dbIds),this.setPosition(this._hitPoint));case"SELECTION_MODE_RESUME_TRANSFORM":setTimeout(function(){t._selectionMode="SELECTION_MODE_TRANSFORM"},300)}}},{key:"setSelection",value:function(e){if(this._selection=e,this._dbIds=this._selection.dbIdArray,this.fullTransform){this._selection.fragIdsArray=[];for(var t=this._selection.model.getFragmentList().fragments.fragId2dbId.length,i=0;i<t;++i)this._selection.fragIdsArray.push(i);this._selection.dbIdArray=[];var n=this._selection.model.getData().instanceTree.getRootId();this._selection.dbIdArray.push(n)}this.initializeSelection(this._hitPoint),this.emit("selection",e)}},{key:"initializeSelection",value:(i=r()(o.a.mark(function e(t){var i,n,a,r=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._selectedFragProxyMap={},i=this._selection.model.transform||{translation:{x:0,y:0,z:0}},this._selection.model.offset={x:t.x-i.translation.x,y:t.y-i.translation.y,z:t.z-i.translation.z},this._transformControlTx.visible=!0,this._transformControlTx.setPosition(t),this._transformControlTx.addEventListener("change",this.onTxChange),this._viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),n=this._selection.dbIdArray,a=this._selection.model,this._selection.fragIdsArray.length){e.next=15;break}return e.next=12,w.a.getFragIds(a,n);case 12:e.t0=e.sent,e.next=16;break;case 15:e.t0=this._selection.fragIdsArray;case 16:e.t0.forEach(function(e){var i=r._viewer.impl.getFragmentProxy(r._selection.model,e);i.getAnimTransform(),i.offset={x:t.x-i.position.x,y:t.y-i.position.y,z:t.z-i.position.z},r._selectedFragProxyMap[e]=i}),this._viewer.impl.sceneUpdated(!0);case 19:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"clearSelection",value:function(){this.active&&(this._transformControlTx.visible=!1,this._selectedFragProxyMap={},this._selection=null,this._dbIds=[],this._transformControlTx.removeEventListener("change",this.onTxChange),this._viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._viewer.impl.sceneUpdated(!0),this.emit("selection",null))}},{key:"setPosition",value:function(e){for(var t in this._transformControlTx.setPosition(e),this._selectedFragProxyMap){var i=this._selectedFragProxyMap[t],n=new THREE.Vector3(e.x-i.offset.x,e.y-i.offset.y,e.z-i.offset.z);i.position=n,i.updateAnimTransform()}var o=new THREE.Vector3(this._transformMesh.position.x-this._selection.model.offset.x,this._transformMesh.position.y-this._selection.model.offset.y,this._transformMesh.position.z-this._selection.model.offset.z);this.emit("translate",{fragIds:Object.keys(this._selectedFragProxyMap),model:this._selection.model,translation:o,dbIds:this._dbIds}),this._viewer.impl.sceneUpdated(!0)}},{key:"normalize",value:function(e){var t=this._viewer.navigation.getScreenViewport();return{x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height}}},{key:"getHitPoint",value:function(e){var t={x:e.clientX,y:e.clientY},i=this.normalize(t);return this._viewer.utilities.getHitPoint(i.x,i.y)}},{key:"hitPoint",value:function(){return this._transformControlTx.position}},{key:"setHitPoint",value:function(e){this._hitPoint.x=e.x,this._hitPoint.y=e.y,this._hitPoint.z=e.z}},{key:"activate",value:function(){if(!this.active){this.active=!0,this._viewer.toolController.activateTool(this.getName());var e=this._viewer.model.getBoundingBox();this._viewer.impl.createOverlayScene("TranslateToolOverlay"),this._transformControlTx=new THREE.TransformControls(this._viewer.impl.camera,this._viewer.impl.canvas,"translate"),this._transformControlTx.setSize(5*e.getBoundingSphere().radius),this._transformControlTx.visible=!1,this._viewer.impl.addOverlay("TranslateToolOverlay",this._transformControlTx),this._transformMesh=this.createTransformMesh(),this._transformControlTx.attach(this._transformMesh),this._viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged),this.emit("activate")}}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this._viewer.toolController.deactivateTool(this.getName()),this._viewer.impl.removeOverlay("TranslateToolOverlay",this._transformControlTx),this._transformControlTx.removeEventListener("change",this.onTxChange),this._viewer.impl.removeOverlayScene("TranslateToolOverlay"),this._viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged),this.emit("deactivate"))}},{key:"onPick",value:function(){this.active&&(this._selectionMode="SELECTION_MODE_PICK")}},{key:"handleButtonDown",value:function(e,t){if(this._isDragging=!0,this.pointerDown=this._transformControlTx.onPointerDown(e),this.pointerDown&&this._selection)return!0;var i=this.getHitPoint(e);return i&&this._hitPoint.copy(i),!1}},{key:"handleButtonUp",value:function(e){return this._isDragging=!1,!!this._transformControlTx.onPointerUp(e)}},{key:"handleMouseMove",value:function(e){return this._isDragging?!!this._transformControlTx.onPointerMove(e):!!this._transformControlTx.onPointerHover(e)}},{key:"handleKeyDown",value:function(e,t){return 27===t&&(this._viewer.clearSelection(),this.deactivate()),!1}}]),t}(f.a))},1355:function(e,t){!function(){"use strict";var e=function(e){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var t=function(e){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=3,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1,n=n||0;for(var o=this,a=0,r=e.length;a<r;a+=3)w(new THREE.Vector3(e[a],e[a+1],e[a+2]));var s=this.vertices,l=[],c=(a=0,0);for(r=t.length;a<r;a+=3,c++){var h=s[t[a]],E=s[t[a+1]],u=s[t[a+2]];l[c]=new THREE.Face3(h.index,E.index,u.index,[h.clone(),E.clone(),u.clone()])}var p=new THREE.Vector3;for(a=0,r=l.length;a<r;a++)g(l[a],n);for(a=0,r=this.faceVertexUvs[0].length;a<r;a++){var m=this.faceVertexUvs[0][a],d=m[0].x,v=m[1].x,y=m[2].x,T=Math.max(d,Math.max(v,y)),f=Math.min(d,Math.min(v,y));T>.9&&f<.1&&(d<.2&&(m[0].x+=1),v<.2&&(m[1].x+=1),y<.2&&(m[2].x+=1))}for(a=0,r=this.vertices.length;a<r;a++)this.vertices[a].multiplyScalar(i);function w(e){var t=e.normalize().clone();t.index=o.vertices.push(t)-1;var i=x(e)/2/Math.PI+.5,n=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new THREE.Vector2(i,1-n),t}function R(e,t,i){var n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);o.faces.push(n),p.copy(e).add(t).add(i).divideScalar(3);var a=x(p);o.faceVertexUvs[0].push([M(e.uv,e,a),M(t.uv,t,a),M(i.uv,i,a)])}function g(e,t){for(var i=Math.pow(2,t),n=(Math.pow(4,t),w(o.vertices[e.a])),a=w(o.vertices[e.b]),r=w(o.vertices[e.c]),s=[],l=0;l<=i;l++){s[l]=[];for(var c=w(n.clone().lerp(r,l/i)),h=w(a.clone().lerp(r,l/i)),E=i-l,u=0;u<=E;u++)s[l][u]=0==u&&l==i?c:w(c.clone().lerp(h,u/E))}for(l=0;l<i;l++)for(u=0;u<2*(i-l)-1;u++){var p=Math.floor(u/2);u%2==0?R(s[l][p+1],s[l+1][p],s[l][p]):R(s[l][p+1],s[l+1][p+1],s[l+1][p])}}function x(e){return Math.atan2(e.z,-e.x)}function M(e,t,i){return i<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(e,t,i,n,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:o},e=e||100,t=t||40,i=i||8,n=n||6,o=o||2*Math.PI;for(var a=new THREE.Vector3,r=[],s=[],l=0;l<=i;l++)for(var c=0;c<=n;c++){var h=c/n*o,E=l/i*Math.PI*2;a.x=e*Math.cos(h),a.y=e*Math.sin(h);var u=new THREE.Vector3;u.x=(e+t*Math.cos(E))*Math.cos(h),u.y=(e+t*Math.cos(E))*Math.sin(h),u.z=t*Math.sin(E),this.vertices.push(u),r.push(new THREE.Vector2(c/n,l/i)),s.push(u.clone().sub(a).normalize())}for(l=1;l<=i;l++)for(c=1;c<=n;c++){var p=(n+1)*l+c-1,m=(n+1)*(l-1)+c-1,d=(n+1)*(l-1)+c,v=(n+1)*l+c,y=new THREE.Face3(p,m,v,[s[p].clone(),s[m].clone(),s[v].clone()]);this.faces.push(y),this.faceVertexUvs[0].push([r[p].clone(),r[m].clone(),r[v].clone()]),y=new THREE.Face3(m,d,v,[s[m].clone(),s[d].clone(),s[v].clone()]),this.faces.push(y),this.faceVertexUvs[0].push([r[m].clone(),r[d].clone(),r[v].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var i=function(e,t,i){var n=new THREE.Geometry;i=i||1;for(var o=0;o<=64*i;++o)"x"==t&&n.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(e)),"y"==t&&n.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(e)),"z"==t&&n.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(e));return n},n=function(e,t,i,n,o,a){var r=new THREE.Geometry,s=new THREE.Mesh(new THREE.CylinderGeometry(e,t,i,n,o,a));return s.position.y=.5,s.updateMatrix(),r.merge(s.geometry,s.matrix),r},o=function(e){var t=new THREE.Geometry;return"X"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===e&&t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),t};THREE.TransformGizmo=function(){var e=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var e=new THREE.PlaneBufferGeometry(50,50,2,2),t=new THREE.MeshBasicMaterial({wireframe:!0});t.side=THREE.DoubleSide;var i={XY:new THREE.Mesh(e,t),YZ:new THREE.Mesh(e,t),XZ:new THREE.Mesh(e,t),XYZE:new THREE.Mesh(e,t)};for(var n in this.activePlane=i.XYZE,i.YZ.rotation.set(0,Math.PI/2,0),i.XZ.rotation.set(-Math.PI/2,0,0),i)i[n].name=n,this.planes.add(i[n]),this.planes[n]=i[n],i[n].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(e){if(e instanceof THREE.Mesh){e.updateMatrix();var t=new THREE.Geometry;e.geometry instanceof THREE.BufferGeometry&&(e.geometry=(new THREE.Geometry).fromBufferGeometry(e.geometry)),t.merge(e.geometry,e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(e){e.visible=!1})},this.show=function(){this.traverse(function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name==e?t.material.highlight(!0):t.material.highlight(!1))})},this.setupGizmos=function(){var e=function(e,t){for(var i in e)for(var n=e[i].length;n--;){var o=e[i][n][0],a=e[i][n][1],r=e[i][n][2],s=e[i][n][3];o.name=i,a&&o.position.set(a[0],a[1],a[2]),r&&o.rotation.set(r[0],r[1],r[2]),s&&(o.visble=s),t.add(o)}};this.setHandlePickerGizmos(),e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(e,t){var i=new THREE.Vector3(0,0,0),n=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse(function(a){a.name&&(-1!=a.name.search("E")?a.quaternion.setFromRotationMatrix(o.lookAt(t,i,n)):-1==a.name.search("X")&&-1==a.name.search("Y")&&-1==a.name.search("Z")||a.quaternion.setFromEuler(e))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(0,.05,.2,12,1,!1),a=o("X"),r=o("Y"),s=o("Z");this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(a,new t({color:15805484}))]],Y:[[new THREE.Mesh(i,new e({color:768011})),[0,.5,0]],[new THREE.Line(r,new t({color:768011}))]],Z:[[new THREE.Mesh(i,new e({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(s,new t({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new e({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new e({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(i(1,"x",.5),new t({color:16711680}))]],RY:[[new THREE.Line(i(1,"y",.5),new t({color:65280}))]],RZ:[[new THREE.Line(i(1,"z",.5),new t({color:255}))]],RE:[[new THREE.Line(i(1.25,"z",1),new t({color:65535}))]],RXYZE:[[new THREE.Line(i(1,"z",1),new t({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new e({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new e({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(e){"RE"==e&&(this.activePlane=this.planes.XYZE),"RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){THREE.TransformGizmo.prototype.update.apply(this,arguments);var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,h=new THREE.Quaternion,E=t.clone();n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),E.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(a,Math.atan2(-E.y,E.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(r,Math.atan2(E.x,E.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(E.y,E.x)),o.multiplyQuaternions(o,h),e.quaternion.copy(o))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var t=this;this.setHandlePickerGizmos=function(){var t=n(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(t,new e({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new e({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new e({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new e({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new e({color:255})),null,null,!1]]}},this.setActivePlane=function(e,t){if("translate"==this.activeMode){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(e,t){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,h=new THREE.Quaternion,E=t.clone();n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),E.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(a,Math.atan2(-E.y,E.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(r,Math.atan2(E.x,E.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(E.y,E.x)),o.multiplyQuaternions(o,h),e.quaternion.copy(o))})}},this.show=function(){this.traverse(function(e){(null==t.parent||t.parent.useAllPickers||e.parent!=t.handles)&&(e.visible=!0),e.material&&(e.material.opacity=e.material.oldOpacity),e.parent!=t.pickers&&e.parent!=t.hemiPicker&&e.parent!=t.subPickers||(e.visible=!1),e.parent!=t.planes&&e.parent!=t.highlights||(e.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(i){i.material&&i.material.highlight&&(i.name==e?(i.parent!=t.highlights&&i.parent!=t.handles||(i.visible=!0),i.material.highlight(!0)):(i.material.highlight(!1),i.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(.125,.125,.125),a=o("X"),r=o("Y"),s=o("Z");this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(a,new t({color:16711680}))]],Y:[[new THREE.Mesh(i,new e({color:65280})),[0,.5,0]],[new THREE.Line(r,new t({color:65280}))]],Z:[[new THREE.Mesh(i,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(s,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new e({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(e,t,i){switch(THREE.Object3D.call(this),t=void 0!==t?t:document,this.gizmo={},i){case"translate":this.gizmo[i]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[i]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[i]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[i]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[i]),this.gizmo[i].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===i){(o=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var n=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(o,n);var o=new THREE.Geometry;n=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(o,n);o=new THREE.Geometry,n=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});o.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(o,n),(a=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=a.minFilter=THREE.NearestFilter;var a;o=new THREE.CircleGeometry(.1,32),n=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:a});this.centerMark=new THREE.Mesh(o,n),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(a=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=a.minFilter=THREE.NearestFilter;n=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:a});var r=.25;this.ticks.RX=new THREE.Object3D;o=new THREE.PlaneBufferGeometry(.12,r);var s=new THREE.Mesh(o,n);s.position.set(0,0,-1.275),s.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(s),(s=s.clone()).position.set(0,-1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),this.ticks.RY=new THREE.Object3D,(s=s.clone()).position.set(0,0,-1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(-1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s)}var l=this,c=!1,h=i,E={type:"change"},u={type:"mouseDown"},p={type:"mouseUp",mode:h},m={type:"objectChange"},d=new THREE.Raycaster,v=new THREE.Vector3,y=new THREE.Vector3,T=new THREE.Vector3,f=new THREE.Vector3,w=new THREE.Vector3,R=new THREE.Vector3,g=1,x=new THREE.Matrix4,M=new THREE.Vector3,H=new THREE.Matrix4,_=new THREE.Vector3,b=new THREE.Quaternion,z=new THREE.Vector3,P=new THREE.Vector3,k=new THREE.Vector3,C=new THREE.Quaternion,I=new THREE.Quaternion,G=new THREE.Quaternion,A=new THREE.Quaternion,V=new THREE.Quaternion,S=new THREE.Vector3,L=new THREE.Vector3,X=new THREE.Matrix4,Y=new THREE.Matrix4,F=new THREE.Vector3,O=new THREE.Vector3,j=new THREE.Euler,Z=new THREE.Matrix4,D=new THREE.Vector3;new THREE.Euler;function q(i,n){var o=t.getBoundingClientRect(),a=(i.clientX-o.left)/o.width*2-1,r=-(i.clientY-o.top)/o.height*2+1;e.isPerspective?(v.set(a,r,.5),v.unproject(e),d.set(e.position,v.sub(e.position).normalize())):(v.set(a,r,-1),v.unproject(e),y.set(0,0,-1),d.set(v,y.transformDirection(e.matrixWorld)));var s=d.intersectObjects(n,!0);return!!s[0]&&s[0]}this.attach=function(e){l.object=e,this.gizmo[h].show(),l.update(),l.updateUnitVectors()},this.detach=function(e){l.object=void 0,this.axis=null,this.gizmo[h].hide()},this.setMode=function(e){"scale"==(h=e||h)&&(l.space="local"),this.gizmo[h].show(),this.update(),l.dispatchEvent(E)},this.getPicker=function(){return l.gizmo[h].hemiPicker.children},this.setPosition=function(e){this.object.position.copy(e),this.update()},this.setNormal=function(e){b.setFromUnitVectors(this.normal,e),this.unitX.applyQuaternion(b),this.unitY.applyQuaternion(b),this.unitZ.applyQuaternion(b),this.normal.copy(e),this.object&&this.object.quaternion.multiply(b),this.update()},this.setSnap=function(e,t){l.snap=e,l.snapDelta=t},this.setSize=function(e){l.size=e,this.update(),l.dispatchEvent(E)},this.setSpace=function(e){l.space=e,this.update(),l.dispatchEvent(E)},this.update=function(i){if(void 0!==l.object){l.object.updateMatrixWorld(),O.setFromMatrixPosition(l.object.matrixWorld),j.setFromRotationMatrix(H.extractRotation(l.object.matrixWorld)),e.updateMatrixWorld(),D.setFromMatrixPosition(e.matrixWorld),this.position.copy(O),this.quaternion.setFromEuler(j),this.normal.set(0,0,1),this.normal.applyEuler(j);var n=O.distanceTo(D),o=e.isPerspective?2*Math.tan(e.fov*Math.PI/360)*n:n,a=t.getBoundingClientRect();g=100*o/a.height,this.scale.set(g,g,g),i&&this.gizmo[h].highlight(l.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(j),this.unitY.applyEuler(j),this.unitZ.applyEuler(j)},this.showRotationGizmos=function(e){for(var t=this.gizmo[h].handles.children,i=0;i<t.length;i++){var n=t[i];n.visible=!0,-1!==n.name.search("R")&&(n.visible=e)}this.useAllPickers=e},this.highlight=function(){this.gizmo[h].highlight(this.axis||"Z")},this.onPointerHover=function(e){if(void 0===l.object||!0===c)return!1;var t=q(e.pointers?e.pointers[0]:e,l.useAllPickers?l.gizmo[h].pickers.children:l.gizmo[h].subPickers.children),i=null,n="";return t&&(n=-1!=(i=t.object.name).search("R")?"rotate":"translate"),l.axis!==i&&(l.axis=i,l.gizmo[h].activeMode=n,l.update(!0),l.dispatchEvent(E)),null===l.axis&&l.gizmo[h].show(),!!t},this.onPointerDown=function(t){if(void 0===l.object||!0===c)return!1;var i=t.pointers?t.pointers[0]:t;if("touch"===t.pointerType){var n=null,o="";(a=q(i,l.useAllPickers?l.gizmo[h].pickers.children:l.gizmo[h].subPickers.children))&&(o=-1!=(n=a.object.name).search("R")?"rotate":"translate"),l.axis!==n&&(l.axis=n,l.gizmo[h].activeMode=o)}var a=null;if((0===i.button||void 0===i.button)&&(a=q(i,l.useAllPickers?l.gizmo[h].pickers.children:l.gizmo[h].subPickers.children))){l.dispatchEvent(u),l.axis=a.object.name,l.update(),M.copy(e.position).sub(O).normalize(),l.gizmo[h].setActivePlane(l.axis,M);var r=q(i,[l.gizmo[h].activePlane]);if(r&&f.copy(r.point),S.copy(l.object.position),L.copy(l.object.scale),X.extractRotation(l.object.matrix),Z.extractRotation(l.object.matrixWorld),l.object.parent?(Y.extractRotation(l.object.parent.matrixWorld),F.setFromMatrixScale(H.getInverse(l.object.parent.matrixWorld))):(Y.extractRotation(l.object.matrixWorld),F.setFromMatrixScale(H.getInverse(l.object.matrixWorld))),"transrotate"===h&&"rotate"===l.gizmo[h].activeMode){l.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(l.matrixWorld),l.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(l.matrixWorld),l.startLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.startLine);var s=l.object.geometry.getAttribute("position"),E=(new THREE.Vector3).fromAttribute(s,0).applyMatrix4(l.object.matrixWorld),p=(new THREE.Vector3).fromAttribute(s,1).applyMatrix4(l.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(s,2).applyMatrix4(l.object.matrixWorld),d=(new THREE.Vector3).fromAttribute(s,3).applyMatrix4(l.object.matrixWorld);if("RX"===l.axis){E.lerp(m,.5),p.lerp(d,.5);var v=E.distanceTo(p);l.centerLine.material.dashSize=v/15,l.centerLine.material.gapSize=v/30,l.centerLine.geometry.vertices[0].copy(E),l.centerLine.geometry.vertices[1].copy(p)}else{E.lerp(p,.5),m.lerp(d,.5);v=E.distanceTo(m);l.centerLine.material.dashSize=v/15,l.centerLine.material.gapSize=v/30,l.centerLine.geometry.vertices[0].copy(E),l.centerLine.geometry.vertices[1].copy(m)}l.centerLine.geometry.computeLineDistances(),l.centerLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.centerLine),l.ticks[l.axis].position.copy(l.position),l.ticks[l.axis].quaternion.copy(l.quaternion),l.ticks[l.axis].scale.copy(l.scale),l.parent.add(l.ticks[l.axis])}}return c=!0,!!a},this.onPointerMove=function(e){if(void 0===l.object||null===l.axis||!1===c)return!1;var t=q(e.pointers?e.pointers[0]:e,[l.gizmo[h].activePlane]);t&&T.copy(t.point);var i=l.gizmo[h].activeMode;if("translate"==i)T.sub(f),T.multiply(F),"local"==l.space&&(T.applyMatrix4(H.getInverse(Z)),z.copy(this.unitX),P.copy(this.unitY),k.copy(this.unitZ),_.set(0,0,0),-1!=l.axis.search("X")&&(z.multiplyScalar(T.dot(this.unitX)),_.add(z)),-1!=l.axis.search("Y")&&(P.multiplyScalar(T.dot(this.unitY)),_.add(P)),-1!=l.axis.search("Z")&&(k.multiplyScalar(T.dot(this.unitZ)),_.add(k)),T.copy(_),T.applyMatrix4(X),l.object.position.copy(S),l.object.position.add(T)),"world"!=l.space&&-1==l.axis.search("XYZ")||(z.copy(this.unitX),P.copy(this.unitY),k.copy(this.unitZ),_.set(0,0,0),-1!=l.axis.search("X")&&(z.multiplyScalar(T.dot(this.unitX)),_.add(z)),-1!=l.axis.search("Y")&&(P.multiplyScalar(T.dot(this.unitY)),_.add(P)),-1!=l.axis.search("Z")&&(k.multiplyScalar(T.dot(this.unitZ)),_.add(k)),T.copy(_),T.applyMatrix4(H.getInverse(Y)),l.object.position.copy(S),l.object.position.add(T));else if("scale"==i)T.sub(f),T.multiply(F),"local"==l.space&&("XYZ"==l.axis?(g=1+T.y/50,l.object.scale.x=L.x*g,l.object.scale.y=L.y*g,l.object.scale.z=L.z*g):(T.applyMatrix4(H.getInverse(Z)),"X"==l.axis&&(l.object.scale.x=L.x*(1+T.x/50)),"Y"==l.axis&&(l.object.scale.y=L.y*(1+T.y/50)),"Z"==l.axis&&(l.object.scale.z=L.z*(1+T.z/50))));else if("rotate"==i){if(T.sub(O),T.multiply(F),_.copy(f).sub(O),_.multiply(F),"RE"==l.axis){T.applyMatrix4(H.getInverse(x)),_.applyMatrix4(H.getInverse(x)),w.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),R.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),b.setFromRotationMatrix(H.getInverse(Y));var n=w.z-R.z;if(null!==l.snap){var o=Math.round(n/l.snap)*l.snap;Math.abs(o-n)<l.snapDelta&&(n=o)}V.setFromAxisAngle(M,n),C.setFromRotationMatrix(Z),b.multiplyQuaternions(b,V),b.multiplyQuaternions(b,C),l.object.quaternion.copy(b)}else if("RXYZE"==l.axis){var a=T.clone().cross(_).normalize();b.setFromRotationMatrix(H.getInverse(Y));var r=-T.clone().angleTo(_);if(null!==l.snap){o=Math.round(r/l.snap)*l.snap;Math.abs(o-r)<l.snapDelta&&(r=o)}I.setFromAxisAngle(a,r),C.setFromRotationMatrix(Z),b.multiplyQuaternions(b,I),b.multiplyQuaternions(b,C),l.object.quaternion.copy(b)}else if("local"==l.space){T.applyMatrix4(H.getInverse(Z)),_.applyMatrix4(H.getInverse(Z));var s=T.dot(this.unitX),u=T.dot(this.unitY),p=T.dot(this.unitZ),d=_.dot(this.unitX),v=_.dot(this.unitY),y=_.dot(this.unitZ);w.set(Math.atan2(p,u),Math.atan2(s,p),Math.atan2(u,s)),R.set(Math.atan2(y,v),Math.atan2(d,y),Math.atan2(v,d));var j=w.x-R.x,D=w.y-R.y;n=w.z-R.z;if(null!==l.snap){if(-1!=l.axis.search("X")){o=Math.round(j/l.snap)*l.snap;Math.abs(o-j)<l.snapDelta&&(j=o)}if(-1!=l.axis.search("Y")){o=Math.round(D/l.snap)*l.snap;Math.abs(o-D)<l.snapDelta&&(D=o)}if(-1!=l.axis.search("Z")){o=Math.round(n/l.snap)*l.snap;Math.abs(o-n)<l.snapDelta&&(n=o)}}I.setFromAxisAngle(this.unitX,j),G.setFromAxisAngle(this.unitY,D),A.setFromAxisAngle(this.unitZ,n),C.setFromRotationMatrix(X),"RX"==l.axis&&C.multiplyQuaternions(C,I),"RY"==l.axis&&C.multiplyQuaternions(C,G),"RZ"==l.axis&&C.multiplyQuaternions(C,A),l.object.quaternion.copy(C)}else if("world"==l.space){s=T.dot(this.unitX),u=T.dot(this.unitY),p=T.dot(this.unitZ),d=_.dot(this.unitX),v=_.dot(this.unitY),y=_.dot(this.unitZ);w.set(Math.atan2(p,u),Math.atan2(s,p),Math.atan2(u,s)),R.set(Math.atan2(y,v),Math.atan2(d,y),Math.atan2(v,d)),b.setFromRotationMatrix(H.getInverse(Y));j=w.x-R.x,D=w.y-R.y,n=w.z-R.z;if(null!==l.snap){if(-1!=l.axis.search("X")){o=Math.round(j/l.snap)*l.snap;Math.abs(o-j)<l.snapDelta&&(j=o)}if(-1!=l.axis.search("Y")){o=Math.round(D/l.snap)*l.snap;Math.abs(o-D)<l.snapDelta&&(D=o)}if(-1!=l.axis.search("Z")){o=Math.round(n/l.snap)*l.snap;Math.abs(o-n)<l.snapDelta&&(n=o)}}I.setFromAxisAngle(this.unitX,j),G.setFromAxisAngle(this.unitY,D),A.setFromAxisAngle(this.unitZ,n),C.setFromRotationMatrix(Z),"RX"==l.axis&&b.multiplyQuaternions(b,I),"RY"==l.axis&&b.multiplyQuaternions(b,G),"RZ"==l.axis&&b.multiplyQuaternions(b,A),b.multiplyQuaternions(b,C),l.object.quaternion.copy(b)}"transrotate"===h&&(l.add(l.endLine),l.add(l.centerMark))}return l.object.matrixAutoUpdate=!0,l.update(!0),l.dispatchEvent(E),l.dispatchEvent(m),!!t},this.onPointerUp=function(e){return c&&null!==l.axis&&(p.mode=h,l.dispatchEvent(p)),c=!1,this.gizmo[h].show(),this.updateUnitVectors(),"transrotate"===h&&"rotate"===this.gizmo[h].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}()},1356:function(e,t,i){"use strict";i.d(t,"a",function(){return v});var n=i(2),o=i.n(n),a=i(3),r=i.n(a),s=i(5),l=i.n(s),c=i(4),h=i.n(c),E=i(50),u=i.n(E),p=i(6),m=i.n(p),d=i(117),v=function(e){function t(e){var i;return o()(this,t),(i=l()(this,h()(t).call(this))).keys={},i.active=!1,i.viewer=e,i.fullTransform=!1,i.viewer.toolController.registerTool(u()(i)),i.onAggregateSelectionChangedHandler=function(e){i.onAggregateSelectionChanged(e)},i}return m()(t,e),r()(t,[{key:"getNames",value:function(){return["Viewing.Tool.Rotate"]}},{key:"getName",value:function(){return"Viewing.Tool.Rotate"}},{key:"setFullTransform",value:function(e){this.fullTransform=e,this.clearSelection()}},{key:"activate",value:function(){this.active||(this.active=!0,this.viewer.toolController.activateTool(this.getName()),this.viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler),this.emit("activate"))}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.viewer.toolController.deactivateTool(this.getName()),this.rotateControl&&(this.rotateControl.remove(),this.rotateControl=null),this.viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler),this.emit("deactivate"))}},{key:"onAggregateSelectionChanged",value:function(e){if(this.rotateControl&&this.rotateControl.engaged)return this.rotateControl.engaged=!1,void this.viewer.select(this.selection.dbIdArray);if(e.selections.length){var t=e.selections[0];if(this.selection=t,this.fullTransform){this.selection.fragIdsArray=[];for(var i=t.model.getFragmentList().fragments.fragId2dbId.length,n=0;n<i;++n)this.selection.fragIdsArray.push(n);this.selection.dbIdArray=[];var o=t.model.getData().instanceTree.getRootId();this.selection.dbIdArray.push(o)}this.drawControl(),this.viewer.fitToView(this.selection.dbIdArray),this.emit("selection",t)}else this.clearSelection()}},{key:"clearSelection",value:function(){this.selection=null,this.rotateControl&&(this.rotateControl.remove(),this.rotateControl=null,this.viewer.impl.sceneUpdated(!0)),this.emit("selection",null)}},{key:"drawControl",value:function(){var e=this,t=this.getWorldBoundingBox(this.selection.fragIdsArray,this.selection.model.getFragmentList());this.center=new THREE.Vector3((t.min.x+t.max.x)/2,(t.min.y+t.max.y)/2,(t.min.z+t.max.z)/2);var i=.8*Math.max(t.max.x-t.min.x,t.max.y-t.min.y,t.max.z-t.min.z);this.rotateControl&&this.rotateControl.remove(),this.rotateControl=new y(this.viewer,this.center,i),this.rotateControl.on("rotate",function(t){e.rotateFragments(e.selection.model,e.selection.fragIdsArray,t.axis,t.angle,e.center),e.viewer.impl.sceneUpdated(!0)})}},{key:"handleButtonDown",value:function(e,t){return!(!this.rotateControl||!this.rotateControl.onPointerDown(e))||!(0!==t||!this.keys.Control)&&(this.isDragging=!0,this.mousePos={x:e.clientX,y:e.clientY},!0)}},{key:"handleButtonUp",value:function(e,t){return this.rotateControl&&this.rotateControl.onPointerUp(e),0===t&&(this.isDragging=!1),!1}},{key:"handleMouseMove",value:function(e){if(this.rotateControl&&this.rotateControl.onPointerHover(e),this.isDragging){if(this.selection){var t={x:this.mousePos.x-e.clientX,y:e.clientY-this.mousePos.y};this.mousePos={x:e.clientX,y:e.clientY};var i=Math.sqrt(t.x*t.x+t.y*t.y),n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,r=new THREE.Vector3,s=this.viewer.getCamera(),l=new THREE.Vector3,c=new THREE.Vector3;c.copy(s.position).sub(s.target),a.copy(c).normalize(),r.copy(s.up).normalize(),n.crossVectors(r,a).normalize(),r.setLength(t.y),n.setLength(t.x),o.copy(r.add(n)),l.crossVectors(o,c).normalize(),this.rotateFragments(this.selection.model,this.selection.fragIdsArray,l,i*Math.PI/180,this.center),this.viewer.impl.sceneUpdated(!0)}return!0}return!1}},{key:"handleKeyDown",value:function(e,t){return this.keys[e.key]=!0,27===t&&this.deactivate(),!1}},{key:"handleKeyUp",value:function(e,t){return this.keys[e.key]=!1,!1}},{key:"rotateFragments",value:function(e,t,i,n,o){var a=this,r=new THREE.Quaternion;r.setFromAxisAngle(i,n),t.forEach(function(i,n){var s=a.viewer.impl.getFragmentProxy(e,i);s.getAnimTransform();var l=new THREE.Vector3(s.position.x-o.x,s.position.y-o.y,s.position.z-o.z);if(l.applyQuaternion(r),l.add(o),s.position=l,s.quaternion.multiplyQuaternions(r,s.quaternion),0===n){var c=new THREE.Euler;c.setFromQuaternion(s.quaternion,0),a.emit("rotate",{dbIds:a.selection.dbIdArray,fragIds:t,rotation:c,model:e})}s.updateAnimTransform()})}},{key:"getWorldBoundingBox",value:function(e,t){var i=new THREE.Box3,n=new THREE.Box3;return e.forEach(function(e){t.getWorldBounds(e,i),n.union(i)}),n}}]),t}(d.a),y=function(e){function t(e,i,n){var a;o()(this,t),(a=l()(this,h()(t).call(this))).engaged=!1,a.overlayScene="rotateControlScene",a.domElement=e.impl.canvas,a.camera=e.impl.camera,a.viewer=e,a.center=i,a.size=n,a.gizmos=[],a.viewer.impl.createOverlayScene(a.overlayScene),a.createAxis(i,new THREE.Vector3(1,0,0),.85*n,16711680),a.createAxis(i,new THREE.Vector3(0,1,0),.85*n,65280),a.createAxis(i,new THREE.Vector3(0,0,1),.85*n,255),a.camera.worldup.y?(a.gizmos.push(a.createGizmo(i,new THREE.Euler(0,Math.PI/2,0),.0045*n,.8*n,16711680,Math.PI,new THREE.Vector3(1,0,0))),a.gizmos.push(a.createGizmo(i,new THREE.Euler(Math.PI/2,0,0),.0045*n,.8*n,65280,2*Math.PI,new THREE.Vector3(0,1,0))),a.gizmos.push(a.createGizmo(i,new THREE.Euler(0,0,0),.0045*n,.8*n,255,Math.PI,new THREE.Vector3(0,0,1)))):(a.gizmos.push(a.createGizmo(i,new THREE.Euler(Math.PI/2,Math.PI/2,0),.0045*n,.8*n,16711680,Math.PI,new THREE.Vector3(1,0,0))),a.gizmos.push(a.createGizmo(i,new THREE.Euler(Math.PI/2,0,0),.0045*n,.8*n,65280,Math.PI,new THREE.Vector3(0,1,0))),a.gizmos.push(a.createGizmo(i,new THREE.Euler(0,0,0),.0045*n,.8*n,255,2*Math.PI,new THREE.Vector3(0,0,1)))),a.picker=a.createSphere(.02*n);var r=new THREE.LineBasicMaterial({color:16776960,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0});return a.angleLine=a.createLine(a.center,a.center,r),e.impl.sceneUpdated(!0),a}return m()(t,e),r()(t,[{key:"createLine",value:function(e,t,i){var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(e.x,e.y,e.z)),n.vertices.push(new THREE.Vector3(t.x,t.y,t.z));var o=new THREE.Line(n,i);return this.viewer.impl.addOverlay(this.overlayScene,o),o}},{key:"createCone",value:function(e,t,i,n){t.normalize();var o={x:e.x+t.x*i,y:e.y+t.y*i,z:e.z+t.z*i},a=new THREE.Matrix4;a.lookAt(e,o,(new THREE.Object3D).up);var r=new THREE.Matrix4;r.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),a.multiply(r);var s=new THREE.CylinderGeometry(0,.2*i,i,128,1),l=new THREE.Mesh(s,n);return l.applyMatrix(a),l.position.x=e.x+t.x*i/2,l.position.y=e.y+t.y*i/2,l.position.z=e.z+t.z*i/2,this.viewer.impl.addOverlay(this.overlayScene,l),l}},{key:"createAxis",value:function(e,t,i,n){var o={x:e.x+t.x*i,y:e.y+t.y*i,z:e.z+t.z*i},a=new THREE.LineBasicMaterial({color:n,linewidth:3,depthTest:!1,depthWrite:!1,transparent:!0});this.createLine(e,o,a),this.createCone(o,t,.1*i,a)}},{key:"createGizmo",value:function(e,t,i,n,o,a,r){var s=new T({color:o}),l=new T({color:o}),c=new THREE.Mesh(new THREE.TorusGeometry(n,i,64,64,a),s),h=new THREE.Mesh(new THREE.TorusGeometry(n,i,64,64,2*Math.PI),l);h.material.highlight(!0);var E=new THREE.Matrix4,u=new THREE.Quaternion;u.setFromEuler(t);var p=new THREE.Vector3(1,1,1);E.compose(e,u,p),c.applyMatrix(E),h.applyMatrix(E);var m=this.createBox(100*this.size,100*this.size,.01);return m.applyMatrix(E),h.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,c),this.viewer.impl.addOverlay(this.overlayScene,h),c.subGizmo=h,c.plane=m,c.axis=r,c}},{key:"createBox",value:function(e,t,i){var n=new T({color:0}),o=new THREE.BoxGeometry(e,t,i),a=new THREE.Mesh(o,n);return a.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,a),a}},{key:"createSphere",value:function(e){var t=new T({color:16776960}),i=new THREE.SphereGeometry(e,32,32),n=new THREE.Mesh(i,t);return n.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,n),n}},{key:"pointerToRaycaster",value:function(e){var t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Raycaster,o=this.domElement.getBoundingClientRect(),a=(e.clientX-o.left)/o.width*2-1,r=-(e.clientY-o.top)/o.height*2+1;return this.camera.isPerspective?(t.set(a,r,.5),t.unproject(this.camera),n.set(this.camera.position,t.sub(this.camera.position).normalize())):(t.set(a,r,-1),t.unproject(this.camera),i.set(0,0,-1),n.set(t,i.transformDirection(this.camera.matrixWorld))),n}},{key:"onPointerDown",value:function(e){var t=e.pointers?e.pointers[0]:e;if(0===t.button){var i=this.pointerToRaycaster(t).intersectObjects(this.gizmos,!0);i.length?(this.gizmos.forEach(function(e){e.visible=!1}),this.selectedGizmo=i[0].object,this.selectedGizmo.subGizmo.visible=!0,this.picker.position.copy(i[0].point),this.angleLine.geometry.vertices[1].copy(i[0].point),this.lastDir=i[0].point.sub(this.center).normalize(),this.angleLine.geometry.verticesNeedUpdate=!0,this.angleLine.visible=!0,this.picker.visible=!0):this.picker.visible=!1,this.engaged=this.picker.visible,this.viewer.impl.sceneUpdated(!0)}return this.picker.visible}},{key:"onPointerHover",value:function(e){var t=e.pointers?e.pointers[0]:e;if(this.engaged){if((r=this.pointerToRaycaster(t).intersectObjects([this.selectedGizmo.plane],!0)).length){var i=r[0].point.sub(this.center).normalize(),n=new THREE.Vector3;n.crossVectors(this.lastDir,i);var o=Math.sign(n.dot(this.selectedGizmo.axis));this.emit("rotate",{angle:o*i.angleTo(this.lastDir),axis:this.selectedGizmo.axis}),this.lastDir=i;var a=new THREE.Vector3(this.center.x+i.x*this.size*.8,this.center.y+i.y*this.size*.8,this.center.z+i.z*this.size*.8);this.picker.position.copy(a),this.angleLine.geometry.vertices[1].copy(a)}this.angleLine.visible=!0,this.angleLine.geometry.verticesNeedUpdate=!0}else{var r;this.angleLine.visible=!1,(r=this.pointerToRaycaster(t).intersectObjects(this.gizmos,!0)).length?(this.picker.position.set(r[0].point.x,r[0].point.y,r[0].point.z),this.picker.visible=!0):this.picker.visible=!1}this.viewer.impl.sceneUpdated(!0)}},{key:"onPointerUp",value:function(e){var t=this;this.angleLine.visible=!1,this.picker.visible=!1,this.gizmos.forEach(function(e){e.visible=!0,e.subGizmo.visible=!1}),this.viewer.impl.sceneUpdated(!0),setTimeout(function(){t.engaged=!1},100)}},{key:"normalize",value:function(e){var t=this.viewer.navigation.getScreenViewport();return{x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height}}},{key:"projectOntoPlane",value:function(e,t){var i=t.dot(e);return new THREE.Vector3(e.x-i*t.x,e.y-i*t.y,e.z-i*t.z)}},{key:"remove",value:function(){this.viewer.impl.removeOverlayScene(this.overlayScene)}}]),t}(d.a),T=function(e){function t(e){var i;return o()(this,t),(i=l()(this,h()(t).call(this))).setValues(e),i.colorInit=i.color.clone(),i.opacityInit=i.opacity,i.side=THREE.FrontSide,i.depthWrite=!1,i.transparent=!0,i.depthTest=!1,i}return m()(t,e),r()(t,[{key:"highlight",value:function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.colorInit),this.opacity=this.opacityInit)}}]),t}(THREE.MeshBasicMaterial)},491:function(e,t,i){"use strict";var n=i(492);t.a=n.a},492:function(e,t,i){"use strict";(function(e){i.d(t,"a",function(){return d});var n=i(2),o=i.n(n),a=i(3),r=i.n(a),s=i(5),l=i.n(s),c=i(4),h=i.n(c),E=i(50),u=i.n(E),p=i(6),m=i.n(p),d=function(t){function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()(this,i),(t=l()(this,h()(i).call(this,e,n)))._viewer=e,t.viewer=e,t._options=n,t.options=n,Object.assign(u()(t),n.serviceContext),t}return m()(i,t),r()(i,[{key:"load",value:function(){return!0}},{key:"unload",value:function(){return!0}},{key:"reload",value:function(e){return!0}},{key:"viewerEvent",value:function(t){var i=this,n=(Array.isArray(t)?t:[t]).map(function(t){return new e(function(e){i.viewer.addEventListener(t,function n(o){i.viewer.removeEventListener(t,n),e(o)})})});return e.all(n)}}],[{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxx",t=(new Date).getTime(),i=e.replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:7&i|8).toString(16)});return i}},{key:"ExtensionId",get:function(){return"Viewing.Extension.Base"}}]),i}(i(117).a.Composer(Autodesk.Viewing.Extension))}).call(this,i(31))}}]);
//# sourceMappingURL=87.js.map