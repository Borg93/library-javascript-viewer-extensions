(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{1148:function(e,t,n){"use strict";n.r(t);n(1149);t.default="Viewing.Extension.Database.Table"},1149:function(e,t,n){"use strict";(function(e){var t=n(120),i=n.n(t),a=n(17),o=n.n(a),r=n(30),s=n.n(r),l=n(43),d=n.n(l),u=n(2),c=n.n(u),p=n(3),h=n.n(p),m=n(5),v=n.n(m),f=n(50),g=n.n(f),y=n(4),b=n.n(y),E=n(460),w=n.n(E),M=n(6),k=n.n(M),x=n(458),_=n(1150),T=(n(1151),n(461)),S=n(122),C=n(531),I=n.n(C),A=n(466),L=n(946),D=n(637),N=n.n(D),O=n(0),V=n.n(O),R=(n(24),n(33)),P=n.n(R),U=function(t){function n(e,t){var i;return c()(this,n),(i=v()(this,b()(n).call(this,e,t))).onUpdateItemSocket=i.onUpdateItemSocket.bind(g()(i)),i.onUpdateItem=i.onUpdateItem.bind(g()(i)),i.onSelectItem=i.onSelectItem.bind(g()(i)),i.onResize=I()(i.onResize,250),i.dbAPI=new _.a(i.options.apiUrl),i.react=t.react,i}var a,r;return k()(n,t),h()(n,[{key:"reload",value:function(e){this.load(!0)}},{key:"load",value:function(e){var t=this;return this.react.setState({selectedItem:null,items:[],dbModal:{open:!1,message:[]},guid:null}).then(function(){e||t.react.pushRenderExtension(t)}),this.socketSvc.on("material.update",this.onUpdateItemSocket),this.socketSvc.connect(),e||this.viewer.loadDynamicExtension("Viewing.Extension.ContextMenu",{buildMenu:function(e){return e.map(function(e){return"show all objects"===e.title.toLowerCase()?{title:"Show All objects",target:function(){A.a.isolateFull(t.viewer),t.viewer.fitToView()}}:e})}}),console.log("Viewing.Extension.Database.Table loaded"),!0}},{key:"unload",value:function(){return console.log("Viewing.Extension.Database.Table unloaded"),this.socketSvc.off("material.update",this.onUpdateItemSocket),w()(b()(n.prototype),"unload",this).call(this),!0}},{key:"buildMaterialMap",value:function(t,n){var i=this;return new e(function(){var e=d()(s.a.mark(function e(a,o){var r,l,d,u,c,p;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={},e.next=4,A.a.getLeafNodes(t);case 4:return l=e.sent,e.next=7,A.a.getBulkPropertiesAsync(t,l,i.options.materialCategories);case 7:return d=e.sent,u=d.map(function(e){return Object.assign({},e.properties[0],{dbId:e.dbId})}),e.next=11,A.a.getBulkPropertiesAsync(t,l,["Mass"]);case 11:c=e.sent,p=c.map(function(e){return Object.assign({},e.properties[0],{dbId:e.dbId})}),l.forEach(function(e){var t=i.materialDBResults[e]||N()(u,{dbId:e}),a=t?"string"==typeof t?t:t.displayValue:null;if("undefined"!==a){var o=N()(n,{name:a});if(o){r[a]||(r[a]={dbMaterial:o,components:[],totalMass:0,totalCost:0});var s=r[a];if(s){var l=N()(p,{dbId:e}),d=l?l.displayValue:1;s.totalMass+=d,s.components.push(e),s.totalCost=s.totalMass*i.toUSD(s.dbMaterial.price,s.dbMaterial.currency)}}}}),a(r),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),o(e.t0);case 20:case"end":return e.stop()}},e,null,[[0,17]])}));return function(t,n){return e.apply(this,arguments)}}())}},{key:"toUSD",value:function(e,t){var n=parseFloat(e);switch(t){case"EUR":return 1.25*n;case"USD":return 1*n;case"JPY":return.0085*n;case"MXN":return.072*n;case"ARS":return.12*n;case"GBP":return 1.58*n;case"CAD":return.88*n;case"BRL":return.39*n;case"CHF":return 1.04*n;case"ZAR":return.091*n;case"INR":return.016*n;case"PLN":return.3*n;case"CNY":return.16*n;case"DKK":return.17*n;case"RUB":return.019*n;default:return 0}}},{key:"onUpdateItem",value:function(e,t){if(e){var n=[];if("string"==typeof e.name&&(e.name=e.name.trim())||n.push("Material name cannot be empty!"),"string"==typeof e.supplier&&(e.supplier=e.supplier.trim())||n.push("Material suppler cannot be empty!"),"string"==typeof e.currency&&(e.currency=e.currency.trim())||n.push("Material currency cannot be empty!"),(isNaN(e.price=parseInt(e.price))||e.price<0)&&n.push("Material price must be a postive number!"),n.length)return void this.react.setState({dbModal:{title:"Error",message:n}});var i=this.react.getState();t||(this.dbAPI.postItem(this.options.database,e),this.socketSvc.broadcast("material.update",e));var a=this.materialMap[e.name];a.dbMaterial=e,a.totalCost=a.totalMass*this.toUSD(a.dbMaterial.price,a.dbMaterial.currency);var o=i.items.map(function(t){return t._id!==e._id?t:e}),r=t?this.guid():i.guid;this.react.setState({items:o,guid:r}),this.costBreakDownExtension.computeCost(this.materialMap);var s=this.buildViewerPanelProperties(e);this.viewerPropertiesExtension.updateProperties(s)}}},{key:"onUpdateItemSocket",value:function(e){this.onUpdateItem(e,!0)}},{key:"onSelectItem",value:function(e,t){if(e=e==this.react.getState().selectedItem?null:e){var n=this.materialMap[e.name],i=n?n.components:e.components||[];this.viewer.fitToView(i),A.a.isolateFull(this.viewer,i)}else A.a.isolateFull(this.viewer),this.viewer.fitToView();this.react.setState({selectedItem:e}),t&&this.costBreakDownExtension.setSelectedItem(e)}},{key:"onModelCompletedLoad",value:(r=d()(s.a.mark(function e(){var t,n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbAPI.getItems("modelmaterials",{query:JSON.stringify({model_id:this.options.modelUrn||this.options.dbModel._id})});case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=[];case 5:return e.t1=function(e,t){return Object.assign(e,o()({},t.dbid,t.material))},e.t2={},this.materialDBResults=e.t0.reduce(e.t1,e.t2),e.next=10,this.dbAPI.getItems(this.options.database);case 10:return this.materials=e.sent,e.next=13,this.buildMaterialMap(this.viewer.model,this.materials);case 13:this.materialMap=e.sent,this.materialNames=this.materials.map(function(e){return e.name}),t=this.materials.filter(function(e){return null!=n.materialMap[e.name]}),this.react.setState({items:t,guid:this.guid()}),this.costBreakDownExtension=this.viewer.getExtension("Viewing.Extension.Database.CostBreakdown"),this.costBreakDownExtension.on("item.selected",this.onSelectItem),this.costBreakDownExtension.computeCost(this.materialMap),this.viewerPropertiesExtension=this.viewer.getExtension("Viewing.Extension.ViewerProperties"),this.viewerPropertiesExtension.on("setProperties",function(e){return n.onSetComponentProperties(e.properties,e.nodeId)});case 22:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"onSetComponentProperties",value:function(t,n){var a=this,o=this.options.forceMaterialProp?this.materialDBResults[n]:null,r=t.filter(function(e){var t=a.options.materialCategories.includes(e.displayName);return t&&!o&&(o=a.materialDBResults[n]||e.displayValue),!t});if(this.materialMap[o]){var s=this.materialMap[o].dbMaterial,l=this.buildViewerPanelProperties(Object.assign(s,{nodeId:n}));r=[].concat(i()(r),i()(l))}else r=[].concat(i()(r),i()(this.buildViewerPanelProperties({nodeId:n})));return e.resolve(r)}},{key:"updateMaterial",value:(a=d()(s.a.mark(function e(t,n){var i,a,o,r=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.options.modelUrn||this.options.dbModel._id,a=this.viewer.getPropertyPanel().container,o=a.className,a.className+=" sb233disabled",this.materialDBResults[n]=t.target.value,this.dbAPI.postItem("modelmaterials/"+i,{model_id:i,dbid:n,material:t.target.value}),e.next=6,this.buildMaterialMap(this.viewer.model,this.materials);case 6:this.materialMap=e.sent,this.costBreakDownExtension.computeCost(this.materialMap),this.react.setState({items:this.materials.filter(function(e){return null!=r.materialMap[e.name]}),guid:this.guid()}),a.className=o,this.viewer.getPropertyPanel().isDirty=!0,this.viewer.getPropertyPanel().refresh();case 12:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"buildViewerPanelProperties",value:function(e){var t=this.updateMaterial.bind(this);return[{id:e._id+"-material",displayName:"Material",displayValue:e.name,dataType:"select",displayCategory:"Database",values:this.materialNames,onchange:function(n){return t(n,e.nodeId)}},{id:e._id+"-supplier",displayName:"Supplier",displayValue:e.supplier,dataType:"text",displayCategory:"Database"},{id:e._id+"-price",displayName:"Price",displayValue:e.price,dataType:"text",displayCategory:"Database"},{id:e._id+"-currency",displayName:"Currency",displayValue:e.currency,dataType:"text",displayCategory:"Database"}]}},{key:"renderTitle",value:function(){return V.a.createElement("div",{className:"title"},V.a.createElement("label",null,"Database"))}},{key:"onResize",value:function(){this.react.setState({guid:this.guid()})}},{key:"renderContent",value:function(){var e=this,t=this.react.getState(),n=t.guid,i=t.items,a=t.selectedItem,o=t.dbModal,r=!i.length||!n;return V.a.createElement("div",{className:"content"},V.a.createElement(S.b,{show:r}),V.a.createElement(L.default,{onSelectItem:this.onSelectItem,onUpdateItem:this.onUpdateItem,selectedItem:a,items:i,guid:n}),V.a.createElement("div",null,V.a.createElement(P.a,{className:"dialog about",contentLabel:"",isOpen:Array.isArray(o.message)&&o.message.length>0,onRequestClose:function(){return e.react.setState({dbModal:{}})}},V.a.createElement("div",{className:"title"},V.a.createElement("b",null,o.title)),V.a.createElement("div",{className:"content "},V.a.createElement("div",null,Array.isArray(o.message)?o.message.map(function(e,t){return V.a.createElement("p",{key:t},e)}):"")))))}},{key:"render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{showTitle:!0};return V.a.createElement(T.a,{renderTitle:function(){return e.renderTitle(t.docked)},showTitle:t.showTitle,className:this.className},this.renderContent())}},{key:"className",get:function(){return"database-table"}}],[{key:"ExtensionId",get:function(){return"Viewing.Extension.Database.Table"}}]),n}(x.a);Autodesk.Viewing.theExtensionManager.registerExtension(U.ExtensionId,U)}).call(this,n(31))},1150:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i=n(2),a=n.n(i),o=n(3),r=n.n(o),s=n(5),l=n.n(s),d=n(4),u=n.n(d),c=n(6),p=n.n(c);function h(e,t){var n=Object.entries(t||{}).map(function(e){return e.map(encodeURIComponent).join("=")}).join("&");return n.length?e+(e.indexOf("&")>-1?"&":"?")+n:e}var m=function(e){function t(e){return a()(this,t),l()(this,u()(t).call(this,e))}return p()(t,e),r()(t,[{key:"getItems",value:function(e,t){var n=e;return this.ajax(h(n,t))}},{key:"postItem",value:function(e,t,n){var i=e;return this.ajax({url:h(i,n),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(t)})}}]),t}(n(40).a)},1151:function(e,t,n){var i=n(1152);"string"==typeof i&&(i=[[e.i,i,""]]);n(27)(i,{});i.locals&&(e.exports=i.locals)},1152:function(e,t,n){(e.exports=n(26)(!1)).push([e.i,".database-table .title {\n  display: -ms-inline-flexbox;\n  display: inline-flex;\n  float: left; }\n\n.database-table .title > label {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  white-space: nowrap;\n  font-weight: normal;\n  user-select: none;\n  margin-left: 27px;\n  margin-top: 10px;\n  select: none;\n  width: 144px;\n  float: left; }\n\n.database-table .content {\n  height: 100%; }\n",""])},458:function(e,t,n){"use strict";var i=n(459);t.a=i.a},459:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return g});var i=n(120),a=n.n(i),o=n(2),r=n.n(o),s=n(3),l=n.n(s),d=n(5),u=n.n(d),c=n(4),p=n.n(c),h=n(50),m=n.n(h),v=n(6),f=n.n(v),g=function(t){function n(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r()(this,n),t=u()(this,p()(n).call(this,e)),Object.assign(m()(t),i.serviceContext),t.onModelCompletedLoad=t.onModelCompletedLoad.bind(m()(t)),t.onObjectTreeCreated=t.onObjectTreeCreated.bind(m()(t)),t.onModelRootLoaded=t.onModelRootLoaded.bind(m()(t)),t.onExtensionLoaded=t.onExtensionLoaded.bind(m()(t)),t.onModelActivated=t.onModelActivated.bind(m()(t)),t.onGeometryLoaded=t.onGeometryLoaded.bind(m()(t)),t.onToolbarCreated=t.onToolbarCreated.bind(m()(t)),t.onModelBeginLoad=t.onModelBeginLoad.bind(m()(t)),t.onModelUnloaded=t.onModelUnloaded.bind(m()(t)),t.onSelection=t.onSelection.bind(m()(t)),t.__onModelRootLoaded=t.__onModelRootLoaded.bind(m()(t)),t.__onModelActivated=t.__onModelActivated.bind(m()(t)),t.__onModelUnloaded=t.__onModelUnloaded.bind(m()(t)),t.__onModelLoaded=t.__onModelLoaded.bind(m()(t)),t.defaultOptions=a,t.options=Object.assign({},a,i),t.viewer=e;var o=e.impl.modelQueue().getModels();return t.models=o.map(function(e){return e.guid=e.guid||t.guid(),e}),t.initializeEvents(),t}return f()(n,t),l()(n,[{key:"load",value:function(){return!0}},{key:"unload",value:function(){var e=this;return this.viewerEvents.forEach(function(t){e.viewer.removeEventListener(t.id,e[t.handler])}),this.eventSink&&(this.eventSink.off("model.activated",this.__onModelActivated),this.eventSink.off("model.unloaded",this.__onModelUnloaded),this.eventSink.off("model.loaded",this.__onModelLoaded)),this.off(),!0}},{key:"reload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=Object.assign({},this.defaultOptions,this.options,e),!0}},{key:"onExtensionLoaded",value:function(e){}},{key:"onModelBeginLoad",value:function(e){}},{key:"onModelActivated",value:function(e){}},{key:"__onModelRootLoaded",value:function(e){var t=this;this.viewerEvent([Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,Autodesk.Viewing.GEOMETRY_LOADED_EVENT]).then(function(e){t.onModelCompletedLoad(e[0])})}},{key:"onModelRootLoaded",value:function(e){}},{key:"onObjectTreeCreated",value:function(e){}},{key:"onGeometryLoaded",value:function(e){}},{key:"onModelCompletedLoad",value:function(e){}},{key:"onToolbarCreated",value:function(e){}},{key:"onModelUnloaded",value:function(e){}},{key:"onSelection",value:function(e){}},{key:"__onModelLoaded",value:function(e){this.models=[].concat(a()(this.models),[e.model]),this.onModelBeginLoad(e)}},{key:"__onModelActivated",value:function(e){this.onModelActivated(e)}},{key:"__onModelUnloaded",value:function(e){this.models=this.models.filter(function(t){return t.guid!==e.model.guid}),this.onModelUnloaded(e)}},{key:"initializeEvents",value:function(){var e=this;this.options.eventSink&&(this.eventSink=this.options.eventSink,this.eventSink.on("model.loaded",this.__onModelLoaded),this.eventSink.on("model.activated",this.__onModelActivated),this.eventSink.on("model.unloaded",this.__onModelUnloaded)),this.viewerEvents=[{id:Autodesk.Viewing.EXTENSION_LOADED_EVENT,handler:"onExtensionLoaded"},{id:Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,handler:"onObjectTreeCreated"},{id:Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,handler:"__onModelRootLoaded"},{id:Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,handler:"onModelRootLoaded"},{id:Autodesk.Viewing.GEOMETRY_LOADED_EVENT,handler:"onGeometryLoaded"},{id:Autodesk.Viewing.TOOLBAR_CREATED_EVENT,handler:"onToolbarCreated"},{id:Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,handler:"onSelection"}],this.viewerEvents.forEach(function(t){e.viewerEvent(t.id,e[t.handler])})}},{key:"viewerEvent",value:function(t,n){var i=this;if(!n){var a=(Array.isArray(t)?t:[t]).map(function(t){return new e(function(e){i.viewer.addEventListener(t,function n(a){i.viewer.removeEventListener(t,n),e(a)})})});return e.all(a)}this.viewer.addEventListener(t,n)}}],[{key:"ExtensionId",get:function(){return"Viewing.Extension.MultiModelExtensionBase"}}]),n}(n(121).a.Composer(Autodesk.Viewing.Extension))}).call(this,n(31))},460:function(e,t,n){var i=n(465);function a(t,n,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=a=Reflect.get:e.exports=a=function(e,t,n){var a=i(e,t);if(a){var o=Object.getOwnPropertyDescriptor(a,t);return o.get?o.get.call(n):o.value}},a(t,n,o||t)}e.exports=a},461:function(e,t,n){"use strict";var i=n(120),a=n.n(i),o=n(2),r=n.n(o),s=n(3),l=n.n(s),d=n(5),u=n.n(d),c=n(4),p=n.n(c),h=n(6),m=n.n(h),v=n(17),f=n.n(v),g=n(1),y=n.n(g),b=(n(29),n(462),n(0)),E=n.n(b),w=function(e){function t(){return r()(this,t),u()(this,p()(t).apply(this,arguments))}return m()(t,e),l()(t,[{key:"renderTitle",value:function(){return this.props.showTitle?this.props.renderTitle?this.props.renderTitle():E.a.createElement("div",{className:"title"},E.a.createElement("label",null,this.props.title)):E.a.createElement("div",null)}},{key:"renderChildren",value:function(){var e=this;return this.props.dimensions?E.a.Children.map(this.props.children,function(t){var n=Object.assign({},t.props,{dimensions:e.props.dimensions});return E.a.cloneElement(t,n)}):this.props.children}},{key:"render",value:function(){var e=["widget-container"].concat(a()(this.props.className.split(" "))),t=this.props.showTitle?"calc(100% - 40px)":"100%";return E.a.createElement("div",{className:e.join(" "),style:this.props.style},this.renderTitle(),E.a.createElement("div",{className:"content",style:{height:t}},this.renderChildren()))}}]),t}(E.a.Component);f()(w,"propTypes",{className:y.a.string,showTitle:y.a.bool}),f()(w,"defaultProps",{showTitle:!0,className:""});var M=w;t.a=M},462:function(e,t,n){var i=n(463);"string"==typeof i&&(i=[[e.i,i,""]]);n(27)(i,{});i.locals&&(e.exports=i.locals)},463:function(e,t,n){(e.exports=n(26)(!1)).push([e.i,".widget-container {\n  position: relative;\n  height: 100%;\n  width: 100%; }\n\n.widget-container > .title {\n  border-bottom: 1px solid #cdcdcd;\n  background-color: #f5f5f5;\n  padding-right: 10px;\n  color: black;\n  position: relative;\n  overflow: hidden;\n  text-align: left;\n  height: 40px;\n  width: 100%; }\n\n.widget-container > .title > label {\n  white-space: nowrap;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  margin-left: 27px;\n  margin-top: 10px; }\n\n.widget-container > .content {\n  position: relative;\n  overflow: hidden;\n  height: 100%;\n  width: 100%; }\n",""])},465:function(e,t,n){var i=n(4);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}},526:function(e,t,n){var i=n(44),a=n(536),o=n(551),r="Expected a function",s=Math.max,l=Math.min;e.exports=function(e,t,n){var d,u,c,p,h,m,v=0,f=!1,g=!1,y=!0;if("function"!=typeof e)throw new TypeError(r);function b(t){var n=d,i=u;return d=u=void 0,v=t,p=e.apply(i,n)}function E(e){var n=e-m;return void 0===m||n>=t||n<0||g&&e-v>=c}function w(){var e=a();if(E(e))return M(e);h=setTimeout(w,function(e){var n=t-(e-m);return g?l(n,c-(e-v)):n}(e))}function M(e){return h=void 0,y&&d?b(e):(d=u=void 0,p)}function k(){var e=a(),n=E(e);if(d=arguments,u=this,m=e,n){if(void 0===h)return function(e){return v=e,h=setTimeout(w,t),f?b(e):p}(m);if(g)return h=setTimeout(w,t),b(m)}return void 0===h&&(h=setTimeout(w,t)),p}return t=o(t)||0,i(n)&&(f=!!n.leading,c=(g="maxWait"in n)?s(o(n.maxWait)||0,t):c,y="trailing"in n?!!n.trailing:y),k.cancel=function(){void 0!==h&&clearTimeout(h),v=0,d=m=u=h=void 0},k.flush=function(){return void 0===h?p:M(a())},k}},531:function(e,t,n){var i=n(526),a=n(44),o="Expected a function";e.exports=function(e,t,n){var r=!0,s=!0;if("function"!=typeof e)throw new TypeError(o);return a(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),i(e,t,{leading:r,maxWait:t,trailing:s})}},536:function(e,t,n){var i=n(51);e.exports=function(){return i.Date.now()}}}]);
//# sourceMappingURL=63.js.map